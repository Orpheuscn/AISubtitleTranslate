# 提示词改进测试

## 改进策略

### 核心思想转变
- ❌ 旧思路：这是翻译任务 → 先翻译成流畅句子 → 再分配到序号
- ✅ 新思路：这是格式化输出任务 → 为每个序号槽位填入翻译内容

### 关键改进点

1. **任务重新定义**
   - 明确告诉 AI：这不是普通翻译，是"格式化输出任务"
   - 强调：输入 N 个序号 → 输出必须 N 个序号

2. **具体示例强化**
   - 使用你提供的完美示例（829-830）
   - 展示正确和错误的对比
   - 说明为什么必须保持序号对应（时间轴原因）

3. **验证步骤明确化**
   - 要求 AI 在输出前执行 4 步验证
   - 数序号数量、检查序号一致性

4. **错误检测增强**
   - 解析后详细报告缺失/多余的序号
   - 显示完整的 API 响应用于调试
   - 分析可能的错误原因

## 测试用例

### 测试用例 1：你提供的示例
输入（2 个序号）：
```
[829] speaks of that suffering woman who can find no rest
[830] and who tosses in her bed due to the pain that torments her,
```

期望输出（2 个序号）：
```
[829] 说起那个无法安眠、
[830] 痛苦辗转的女人时，
```

### 测试用例 2：地名列表（3 个序号）
输入（3 个序号）：
```
[763] The total value of his homes and villas,
[764] in Florence, in Careggi, in Cafaggiolo,
[765] in Trebbio, in Pisa and in Milan:
```

期望输出（3 个序号）：
```
[763] 他的住宅与别墅的总价值，
[764] 位于佛罗伦萨、卡雷吉、卡法焦洛、
[765] 特雷比奥、比萨和米兰：
```

## 下一步测试

1. 运行翻译，观察控制台输出
2. 检查是否还有"翻译数量不匹配"的错误
3. 如果仍有问题，查看完整的 API 响应，分析 AI 的思考过程
4. 根据实际情况进一步调整提示词

## 可能需要的进一步改进

如果问题仍然存在，可以考虑：

1. **Few-shot 示例**：在系统提示词中加入更多正确/错误示例
2. **Chain-of-Thought**：要求 AI 先列出序号清单，再逐个翻译
3. **结构化输出**：使用 JSON 格式强制序号对应
4. **后处理修复**：如果检测到数量不匹配，自动重试该批次

